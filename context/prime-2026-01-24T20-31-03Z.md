# Codebase Export: 2026-01-24T20:31:03Z

## Project Tree

```
AI Overload/
├── .claude/
│   ├── commands/
│   │   ├── prime.md
│   │   ├── discovery.md
│   │   ├── planning.md
│   │   ├── development.md
│   │   ├── task-planning.md
│   │   ├── execution.md
│   │   ├── review.md
│   │   ├── test.md
│   │   ├── template.md
│   │   ├── update-index.md
│   │   ├── update-status.md
│   │   └── workflow.md
│   ├── templates/
│   │   └── STATUS.md
│   └── settings.json
├── context/
│   ├── INDEX.md
│   ├── prime-2026-01-24T09-32-50Z.md
│   └── prime-2026-01-24T18-21-11Z.md
├── discovery/
│   ├── INDEX.md
│   └── discovery-2026-01-24T18-33-22Z.md
├── execution/
│   ├── INDEX.md
│   ├── 01-create-directory-structure.md
│   ├── 02-create-index-generator.md
│   ├── (28 task files total)
├── features/
│   ├── INDEX.md
│   └── smart-reference-library/
│       ├── prp.md
│       ├── task-plan.md
│       ├── STATUS.md
│       └── execution/
│           ├── INDEX.md
│           ├── 01-run-sql-migration.md
│           ├── 02-create-learn-command.md
│           ├── 03-create-learn-health-command.md
│           ├── 04-update-prp-templates.md
│           ├── 05-update-claude-md.md
│           ├── 06-test-learn-command.md
│           └── 07-test-learn-health-command.md
├── templates/
│   ├── INDEX.md
│   └── prp/
│       ├── prp-base.md
│       ├── prp-ai-agent.md
│       ├── prp-mcp-integration.md
│       ├── prp-api-endpoint.md
│       └── prp-frontend-component.md
├── reviews/
│   └── INDEX.md
├── testing/
│   └── INDEX.md
├── CLAUDE.md
├── INDEX.md
├── MVP.md
├── PRD.md
├── README.md
└── TECH-SPEC.md
```

## Files

### .claude/commands/prime.md

```markdown
---
name: Prime
description: "Export entire codebase for context gathering with structured markdown output"
phase: prime
dependencies: []
outputs:
  - path: "context/prime-{timestamp}.md"
    description: "Structured markdown export of codebase"
  - path: "context/INDEX.md"
    description: "Index of all prime exports"
inputs: []
---

# Prime Command

## Purpose

Export the entire codebase for context gathering. This command traverses the project directory, respects ignore patterns, and generates a structured markdown export with tree structure and file contents. This provides comprehensive context for AI assistants to understand the codebase structure, patterns, and conventions.

## Execution Steps

### Step 1: Traverse Codebase
- Use Git to get list of tracked files: `git ls-files`
- Respect `.gitignore` and `.cursorignore` patterns
- Skip binary files (detect by extension: .png, .jpg, .gif, .pdf, .zip, etc.)
- Skip files larger than 10MB (log skipped files)
- Skip node_modules, .git, .venv, and other common ignore patterns

### Step 2: Generate Tree Structure
- Use `tree` command or custom traversal to generate directory structure
- Format as markdown code block with proper indentation
- Include file counts per directory

### Step 3: Export File Contents
- Read each file sequentially
- Wrap file contents in markdown code blocks with language tags (detect from extension)
- Include file path as heading (e.g., `### src/api/users.ts`)
- For very large files (>1000 lines), include first 500 and last 500 lines with note

### Step 4: Create Index
- Count files by language/type
- Calculate total lines of code
- List dependencies (from package.json, requirements.txt, etc. if detectable)
- Create summary statistics

### Step 5: Save Output
- Generate timestamp in ISO 8601 format: `YYYY-MM-DDTHH:mm:ssZ`
- Save to `context/prime-{timestamp}.md`
- Update `context/INDEX.md` with new entry:
  - Link to new prime export
  - Timestamp
  - File count and line count summary
```

### .claude/commands/discovery.md

```markdown
---
name: Discovery
description: "Explore ideas, inspiration, and needs for AI agents and AI/ATR applications"
phase: discovery
dependencies: [prime]
outputs:
  - path: "discovery/discovery-{timestamp}.md"
    description: "Discovery document with ideas, inspiration sources, needs analysis, and opportunities"
  - path: "discovery/INDEX.md"
    description: "Updated index of all discovery documents"
inputs:
  - path: "context/prime-{timestamp}.md"
    description: "Most recent codebase export from Prime command"
    required: true
---

# Discovery Command

## Purpose

Explore ideas, inspiration, and needs for AI agents and AI/ATR applications. This command loads the prime context, queries AI via MCP (using RAG knowledge base and web MCP servers), performs needs analysis, and generates a discovery document.
```

### .claude/commands/planning.md

```markdown
---
name: Planning
description: "Transform discovery insights into comprehensive PRD (Product Requirements Document)"
phase: planning
dependencies: [discovery]
outputs:
  - path: "PRD.md"
    description: "Product Requirements Document at root with features, user stories, acceptance criteria, and technical requirements"
inputs:
  - path: "discovery/discovery-{timestamp}.md"
    description: "Most recent discovery document with ideas, opportunities, and needs analysis"
    required: true
  - path: "MVP.md"
    description: "MVP definition at root"
    required: true
---

# Planning Command

## Purpose

Transform discovery insights into a comprehensive PRD (Product Requirements Document). This command loads the discovery document, extracts the feature name, creates the feature directory structure, researches PRD templates using RAG knowledge base and web MCP servers, generates PRD with features, user stories, acceptance criteria, and technical requirements, and updates indexes and STATUS.md.
```

### .claude/commands/development.md

```markdown
---
name: Development
description: "Analyze PRD requirements and generate comprehensive Tech Spec with technology stack recommendations"
phase: development
dependencies: [planning]
outputs:
  - path: "TECH-SPEC.md"
    description: "Technical Specification at root with system architecture, technology stack, implementation details, and recommendations"
inputs:
  - path: "PRD.md"
    description: "Product Requirements Document at root"
    required: true
  - path: "MVP.md"
    description: "MVP definition at root"
    required: true
---

# Development Command

## Purpose

Analyze PRD requirements and generate a comprehensive Tech Spec (Technical Specification). This command loads the PRD, uses RAG knowledge base and web MCP servers to research architecture patterns and tech stacks, recommends technology stack (backend, frontend, MCP servers, AI frameworks, models, agent architecture), and generates detailed tech spec with system architecture, technology stack, command structure, file system structure, data models, MCP integration, command implementation, error handling, performance, and security.
```

### .claude/commands/task-planning.md

```markdown
---
name: Task Planning
description: "Combine all contexts into actionable tasks with PRP guidance"
phase: task-planning
dependencies: [development]
outputs:
  - path: "features/{feature-name}/prp.md"
    description: "Plan Reference Protocol document with codebase-aware implementation guidance"
  - path: "features/{feature-name}/task-plan.md"
    description: "Task plan with task IDs, dependencies, and execution order"
  - path: "features/{feature-name}/STATUS.md"
    description: "Updated feature status tracking file"
  - path: "features/{feature-name}/execution/"
    description: "Execution folder with individual task files (deleted as tasks complete)"
inputs:
  - path: "context/prime-{timestamp}.md"
    description: "Most recent codebase export from Prime command"
    required: true
  - path: "discovery/discovery-{timestamp}.md"
    description: "Most recent discovery document"
    required: false
  - path: "MVP.md"
    description: "MVP definition at root"
    required: true
  - path: "PRD.md"
    description: "Product Requirements Document at root"
    required: true
  - path: "TECH-SPEC.md"
    description: "Technical Specification at root"
    required: true
---

# Task Planning Command

## Purpose

Combine all contexts (Prime, Discovery, PRD, Tech Spec) into actionable tasks with PRP guidance. This command loads all contexts, extracts codebase patterns, selects appropriate PRP template, generates PRP with codebase-aware context, breaks down tasks with dependencies, creates tasks in Archon MCP, and generates task plan document.
```

### .claude/commands/execution.md

```markdown
---
name: Execution
description: "Execute tasks step-by-step following task plan and PRP guidance"
phase: execution
dependencies: [task-planning]
outputs:
  - path: "features/{feature-name}/execution.md"
    description: "Execution log showing progress through tasks"
  - path: "features/{feature-name}/STATUS.md"
    description: "Updated status showing execution progress"
inputs:
  - path: "features/{feature-name}/task-plan.md"
    description: "Task plan with ordered tasks and dependencies"
    required: true
  - path: "features/{feature-name}/prp.md"
    description: "PRP document with implementation guidance"
    required: true
  - path: "features/{feature-name}/execution/"
    description: "Execution folder with individual task files"
    required: true
---

# Execution Command

## Purpose

Execute tasks step-by-step following the task plan and PRP guidance. This command loads the task plan and PRP, executes tasks sequentially using Archon MCP for tracking, handles errors with checkpoint/resume, and updates STATUS.md with progress.
```

### .claude/commands/review.md

```markdown
---
name: Review
description: "AI-powered code review with quality, security, and performance analysis"
phase: review
dependencies: [execution]
outputs:
  - path: "features/{feature-name}/review.md"
    description: "Code review report for feature"
  - path: "reviews/review-{timestamp}.md"
    description: "Timestamped review report in reviews directory"
  - path: "reviews/INDEX.md"
    description: "Updated index of all reviews"
  - path: "features/{feature-name}/STATUS.md"
    description: "Updated feature status tracking file"
inputs:
  - path: "context/prime-{timestamp}.md"
    description: "Baseline codebase export from Prime command"
    required: true
  - path: "features/{feature-name}/prd.md"
    description: "Product Requirements Document for compliance verification"
    required: true
  - path: "features/{feature-name}/tech-spec.md"
    description: "Technical Specification for compliance verification"
    required: true
  - path: "features/{feature-name}/execution.md"
    description: "Execution log with completed tasks"
    required: true
---

# Review Command

## Purpose

Perform AI-powered code review by identifying code changes, analyzing quality (best practices, security, performance), verifying compliance with PRD and tech spec, and generating a comprehensive review report with severity levels, fix recommendations, and code examples.
```

### .claude/commands/test.md

```markdown
---
name: Test
description: "Automated testing with error detection and AI-suggested fixes"
phase: test
dependencies: [execution]
outputs:
  - path: "features/{feature-name}/test-results.md"
    description: "Test results report for feature"
  - path: "testing/test-results-{timestamp}.md"
    description: "Timestamped test results in testing directory"
  - path: "testing/INDEX.md"
    description: "Updated index of all test results"
  - path: "features/{feature-name}/STATUS.md"
    description: "Updated feature status tracking file"
inputs:
  - path: "features/{feature-name}/prd.md"
    description: "Product Requirements Document for acceptance criteria verification"
    required: true
  - path: "features/{feature-name}/prp.md"
    description: "Plan Reference Protocol for test patterns and validation commands"
    required: true
  - path: "features/{feature-name}/execution.md"
    description: "Execution log with completed tasks"
    required: true
---

# Test Command

## Purpose

Automate testing with error detection and AI-suggested fixes. This command runs test suites (unit, integration, E2E), detects errors, uses AI to suggest fixes, generates coverage reports, verifies acceptance criteria, and stores test results.
```

### .claude/commands/template.md

```markdown
---
name: Command Name
description: "Brief description of what this command does"
phase: prime|discovery|planning|development|task-planning|execution|review|test
dependencies: []
outputs:
  - path: "relative/path/to/output.md"
    description: "Description of output"
inputs:
  - path: "relative/path/to/input.md"
    description: "Description of input"
    required: true|false
---

# Command Name

## Purpose

[Detailed description of command purpose]

This command [what it does]. It is used during the [phase] phase to [specific purpose].
```

### .claude/commands/update-index.md

```markdown
---
name: update-index
description: Update INDEX.md file with new file entry or regenerate from directory contents
phase: utility
inputs:
  - directory: Directory path containing INDEX.md (e.g., "context", "discovery", "features")
  - filename: Name of file to add (optional if regenerating)
  - description: Description of file (optional, auto-extracted if not provided)
  - timestamp: ISO 8601 timestamp (optional, defaults to current time)
  - is_directory: True if adding a subdirectory (for features/)
  - regenerate: If true, regenerate entire INDEX.md from directory contents
outputs:
  - Updated INDEX.md file with new entry
dependencies:
  - Directory must exist
  - INDEX.md may or may not exist (will create if missing)
---

# Update INDEX Command

## Purpose

Update or create INDEX.md files with file entries to provide navigation and tracking across the AI Coding Workflow System.
```

### .claude/commands/update-status.md

```markdown
---
name: update-status
description: Update STATUS.md file with phase progress, artifacts, and next steps
phase: utility
inputs:
  - feature_path: Path to feature directory (e.g., "features/ai-coding-workflow-system")
  - action: Action to perform - create, update-phase, add-artifact, update-next-steps, update-checkpoint
  - phase: Phase name to update (Prime, Discovery, Planning, Development, Task Planning, Execution, Review, Test)
  - completed: Whether phase is completed (true/false)
  - set_current: Whether to set as current phase (true/false)
  - artifact_name: Name of artifact file to add
  - artifact_description: Description of artifact (optional)
  - next_steps: Description of next steps
  - task_id: ID or description of last completed task (for checkpoint)
outputs:
  - Updated STATUS.md file
dependencies:
  - Feature directory must exist
  - STATUS.md may or may not exist (will create if missing)
---

# Update STATUS Command

## Purpose

Update or create STATUS.md files to track feature development progress through all phases of the workflow.
```

### .claude/commands/workflow.md

```markdown
---
name: Workflow
description: "Unified workflow command for complete development lifecycle"
phase: workflow
dependencies: [prime, discovery, planning, development, task-planning, execution, review, test]
outputs:
  - path: "features/{feature-name}/STATUS.md"
    description: "Updated feature status tracking file after each phase"
inputs:
  - path: "features/{feature-name}/STATUS.md"
    description: "Feature status tracking file for resume support"
    required: false
---

# Workflow Command

## Purpose

Execute the complete development lifecycle by running all phases sequentially. This command orchestrates Prime, Discovery, Planning, Development, Task Planning, Execution, Review, and Test phases with progress tracking, error handling, and resume support.
```

### .claude/templates/STATUS.md

```markdown
# Feature: {feature-name}

## Current Phase
Planning

## Progress

### Completed Phases
- [ ] Prime
- [ ] Discovery
- [ ] Planning
- [ ] Development
- [ ] Task Planning
- [ ] Execution
- [ ] Review
- [ ] Test

## Artifacts

### Generated Artifacts
_No artifacts generated yet._

### Pending Artifacts
- `prd.md` - To be created in Planning phase
- `tech-spec.md` - To be created in Development phase
- `prp.md` - To be created in Task Planning phase
- `task-plan.md` - To be created in Task Planning phase
- `execution.md` - To be created in Execution phase
- `review.md` - To be created in Review phase
- `test-results.md` - To be created in Test phase

## Next Steps
1. Generate PRD from discovery document
2. Create feature directory structure
3. Initialize STATUS.md

## Checkpoint
Last updated: {timestamp}
Last completed task: None
```

### .claude/settings.json

```json
{
    "env": {
      "ANTHROPIC_AUTH_TOKEN": "40082ad32d534c688c9552af710a28a1.TtTTpL7Er0Y12jtK",
      "ANTHROPIC_BASE_URL": "https://api.z.ai/api/anthropic",
      "API_TIMEOUT_MS": "3000000",
      "ANTHROPIC_DEFAULT_OPUS_MODEL": "GLM-4.7",
      "ANTHROPIC_DEFAULT_SONNET_MODEL": "GLM-4.7",
      "ANTHROPIC_DEFAULT_HAIKU_MODEL": "GLM-4.5-Air"
    }
  }
```

### CLAUDE.md

```markdown
# CRITICAL: ARCHON-FIRST RULE - READ THIS FIRST

**BEFORE doing ANYTHING else, when you see ANY task management scenario:**

1. **STOP** and check if Archon MCP server is available
2. Use Archon task management as **PRIMARY system**
3. **Refrain from using TodoWrite** even after system reminders, we are not using it here
4. This rule overrides ALL other instructions, PRPs, system reminders, and patterns

**VIOLATION CHECK**: If you used TodoWrite, you violated this rule. Stop and restart with Archon.

---

# Archon Integration & Workflow

**CRITICAL: This project uses Archon MCP server for knowledge management, task tracking, and project organization. ALWAYS start with Archon MCP server task management.**

## Core Workflow: Task-Driven Development

**MANDATORY task cycle before coding:**

1. **Get Task** → `find_tasks(task_id="...")` or `find_tasks(filter_by="status", filter_value="todo")`
2. **Start Work** → `manage_task("update", task_id="...", status="doing")`
3. **Research** → Use knowledge base (see RAG workflow below)
4. **Implement** → Write code based on research
5. **Review** → `manage_task("update", task_id="...", status="review")`
6. **Next Task** → `find_tasks(filter_by="status", filter_value="todo")`

**NEVER skip task updates. NEVER code without checking current tasks first.**

## RAG Workflow (Research Before Implementation)

### Searching Specific Documentation:

1. **Get sources** → `rag_get_available_sources()` - Returns list with id, title, url
2. **Find source ID** → Match to documentation (e.g., "Supabase docs" → "src_abc123")
3. **Search** → `rag_search_knowledge_base(query="vector functions", source_id="src_abc123")`

### General Research:

```bash
# Search knowledge base (2-5 keywords only!)
rag_search_knowledge_base(query="authentication JWT", match_count=5)

# Find code examples
rag_search_code_examples(query="React hooks", match_count=3)
```

**CRITICAL: Keep queries SHORT and FOCUSED (2-5 keywords), not long sentences.**

✅ **Good**: "vector search pgvector", "React useState", "authentication JWT"
❌ **Bad**: "how to implement vector search with pgvector in PostgreSQL for semantic similarity matching"

### Web MCP Servers (Discovery & Planning)

For external research during Discovery and Planning phases, use web MCP servers for token optimization:

**When to Use**:
- **Discovery Phase**: Finding inspiration sources, best practices, AI agent patterns
- **Planning Phase**: Researching PRD templates, architecture patterns, technology decisions
- **Token Optimization**: When you need multiple web searches or content extraction

**Available Tools**:
- `web_search_prime_search` - Enhanced web search (Discovery/Planning)
- `web_reader_read` - Read and extract content from web pages (Discovery/Planning)
- `zread_read` - Advanced web content reading and analysis (Discovery/Planning)

**Fallback**: If web MCP servers unavailable, use Claude's built-in web search (may consume more tokens).

## Project Workflows

### New Project:

```bash
# 1. Create project
manage_project("create", title="My Feature", description="...")

# 2. Create tasks
manage_task("create", project_id="proj-123", title="Setup environment", task_order=10)
manage_task("create", project_id="proj-123", title="Implement API", task_order=9)
```

### Existing Project:

```bash
# 1. Find project
find_projects(query="auth")  # or find_projects() to list all

# 2. Get project tasks
find_tasks(filter_by="project", filter_value="proj-123")

# 3. Continue work or create new tasks
```

## Tool Reference

### Projects:

- `find_projects(query="...")` - Search projects
- `find_projects(project_id="...")` - Get specific project
- `manage_project("create"/"update"/"delete", title="...", description="...", github_repo="...")` - Manage projects

### Tasks:

- `find_tasks(query="...")` - Search tasks by keyword
- `find_tasks(task_id="...")` - Get specific task (returns full details)
- `find_tasks(filter_by="status"/"project"/"assignee", filter_value="...")` - Filter tasks
- `manage_task("create"/"update"/"delete", task_id="...", project_id="...", title="...", description="...", status="...", assignee="...", task_order="...")` - Manage tasks

**Task Status Flow**: `todo` → `doing` → `review` → `done`

**Task Granularity**:
- For feature-specific projects: Create detailed implementation tasks (setup, implement, test, document)
- For codebase-wide projects: Create feature-level tasks
- Each task should represent 30 minutes to 4 hours of work
- Higher `task_order` = higher priority (0-100)

### Knowledge Base (RAG):

- `rag_get_available_sources()` - List all available knowledge sources
- `rag_search_knowledge_base(query="...", source_id="...", match_count=5, return_mode="pages")` - Search knowledge base
- `rag_search_code_examples(query="...", source_id="...", match_count=5)` - Find code examples
- `rag_list_pages_for_source(source_id="...", section="...")` - List pages in a source
- `rag_read_full_page(page_id="..." | url="...")` - Read complete page content

### Documents:

- `find_documents(project_id="...", document_id="...", query="...", document_type="...")` - Find documents
- `manage_document("create"/"update"/"delete", project_id="...", document_id="...", title="...", document_type="...", content="...", tags="...")` - Manage documents

### Other Tools:

- `health_check()` - Check MCP server health
- `session_info()` - Get session information

## MCP Server Health & Fallback

### Checking Server Availability

**Before starting work, verify Archon MCP is available:**

```bash
# Check Archon MCP health
health_check()  # Should return healthy status
```

**If Archon MCP is unavailable:**
1. **Inform user** that Archon MCP is unavailable
2. **Ask user** if they want to proceed with limited functionality or wait
3. **Do NOT use TodoWrite** - wait for Archon MCP to be available
4. **Document the issue** in your response

**If Web MCP servers are unavailable:**
- Use Claude's built-in web search as fallback
- Inform user that advanced web features may be limited
- Continue with available functionality

### Fallback Behavior

**Archon MCP Unavailable**:
- **DO NOT** fall back to TodoWrite (per ARCHON-FIRST RULE)
- **STOP** and inform user
- **WAIT** for Archon MCP to be available before proceeding

**Web MCP Servers Unavailable**:
- Use Claude's built-in web search
- May consume more tokens
- Continue with available functionality

## Important Notes

- **Task status flow**: `todo` → `doing` → `review` → `done`
- **Keep queries SHORT** (2-5 keywords) for better search results
- **Higher `task_order`** = higher priority (0-100)
- **Tasks should be 30 min - 4 hours** of work
- **Only ONE task in 'doing' status** at a time
- **Use 'review'** for completed work awaiting validation
- **Mark tasks 'done'** only after verification

## Development Principles

### YAGNI (You Aren't Gonna Need It)

- **Don't implement features that are not needed**
- Focus on current requirements, not future possibilities
- Avoid over-engineering and premature optimization
- Build only what's necessary for current task

### KISS (Keep It Simple, Stupid)

- Prefer simple solutions over complex ones
- Avoid unnecessary abstractions
- Write code that's easy to understand and maintain

### DRY (Don't Repeat Yourself)

- Extract common patterns when appropriate
- Reuse code and components
- But don't over-abstract - balance with YAGNI

## Documentation Standards

**CRITICAL: Apply YAGNI/KISS to all documentation**

- **Line Limits**: MVP, PRD, TECH-SPEC must be 500-600 lines max (fewer is better)
- **YAGNI**: Only document what's needed NOW, remove verbose explanations, examples, and non-essential content
- **KISS**: Use simple, direct language. Remove marketing fluff, redundant sections, and verbose descriptions
- **Focus**: Keep only essential technical details, requirements, and implementation guidance
- **When Creating/Updating Docs**: Always trim unnecessary content, condense verbose sections, remove redundant information

## Error Handling

**When errors occur:**

1. **Stop and assess** - Don't continue with broken state
2. **Inform user clearly** - Explain what went wrong and why
3. **Suggest recovery** - Provide actionable next steps
4. **Preserve work** - Don't lose progress; checkpoint if possible
5. **Learn from errors** - Document patterns to avoid repetition

**Common Error Scenarios**:
- **MCP server unavailable**: Check health, inform user, wait for availability
- **Task not found**: Verify task ID, check project context, ask user
- **File operation failed**: Check permissions, verify path, inform user
- **RAG search returns no results**: Try broader query, check source availability

**Error Recovery Pattern**:
```bash
# 1. Attempt operation
# 2. If error, check health/availability
# 3. Inform user with context
# 4. Suggest alternative or wait
# 5. Retry when conditions met
```

---

## AI Coding Workflow System Commands

This project uses a markdown-based command system for orchestrating AI-assisted development workflows.

### Available Commands:

- `/prime` - Export codebase for context gathering
- `/discovery` - Explore ideas and opportunities
- `/planning {feature-name}` - Generate PRD
- `/development {feature-name}` - Generate Tech Spec
- `/task-planning {feature-name}` - Create PRP and tasks
- `/execution {feature-name}` - Execute tasks
- `/review {feature-name}` - Code review
- `/test {feature-name}` - Run tests
- `/workflow {feature-name}` - Execute full workflow

See `PRD.md` and `TECH-SPEC.md` for detailed command documentation.

## PRP Template Usage

**During Task Execution, always reference PRP documents:**

1. **Load PRP** → Read `features/{feature-name}/prp.md` before starting implementation
2. **Follow Blueprint** → Use PRP's "Implementation Blueprint" section for step-by-step guidance
3. **Reference Patterns** → Follow codebase patterns documented in PRP
4. **Check Gotchas** → Review "Known Gotchas" section to avoid common pitfalls
5. **Validate** → Use PRP's "Validation Loop" commands for quality checks

**PRP Structure Reference**:
- **Goal**: What you're building and success criteria
- **All Needed Context**: Documentation, codebase patterns, file references
- **Implementation Blueprint**: Ordered tasks with dependencies
- **Validation Loop**: Syntax, unit tests, integration tests

**If PRP doesn't exist**:
- Run `/task-planning {feature-name}` first to generate PRP
- Or ask user if they want to proceed without PRP (not recommended)

## Decision-Making Framework

**When to proceed autonomously:**
- ✅ Task is clear from PRP/context
- ✅ Implementation pattern is established
- ✅ No ambiguity in requirements
- ✅ Standard file operations (create/edit within feature scope)
- ✅ Following existing codebase patterns

**When to ask user:**
- ❓ Requirements are ambiguous or conflicting
- ❓ Multiple valid approaches exist and choice matters
- ❓ Breaking changes or major refactoring needed
- ❓ External dependencies or configuration required
- ❓ User preferences or business logic decisions needed
- ❓ MCP server unavailable (critical blocker)

**Decision Rule**: If unsure, **ask**. Better to clarify than assume incorrectly.

---

## When Working with This Codebase

1. **Always check Archon MCP first** for tasks and projects
2. **Research before implementing** using RAG knowledge base
3. **Load PRP document** before starting implementation (if available)
4. **Update task status** as you work (todo → doing → review → done)
5. **Follow YAGNI** - don't build what isn't needed
6. **Follow KISS** - keep it simple, prefer straightforward solutions over complex ones
7. **Use workflow commands** for structured development
8. **Check MCP server health** if operations fail unexpectedly

### File Modification Guidelines

**Safe to edit autonomously:**
- Files within `features/{feature-name}/` directory (current feature scope)
- New files being created as part of current task
- Documentation files (README, STATUS.md) for current feature
- Test files for current feature

**Ask before editing:**
- Files outside current feature directory
- Core system files (commands, templates, root configs)
- Files shared across multiple features
- Breaking changes or major refactoring
- User's explicitly open/visible files (unless task requires it)

**File Operation Best Practices:**
- Read file first to understand context
- Preserve existing patterns and style
- Make minimal, focused changes
- Document why changes were made (in commit messages or comments)

---

**Remember**: Archon MCP is PRIMARY task management system. Never use TodoWrite. Always start with Archon.
```

### INDEX.md

```markdown
# AI Coding Workflow System - INDEX

## Overview

This is a markdown-based command system for orchestrating AI-assisted development workflows through MCP integration. It manages the complete lifecycle from codebase context to implementation, review, and testing.

## Directory Navigation

- **[context/](./context/)** - Prime exports (codebase context)
- **[discovery/](./discovery/)** - Discovery documents (ideas and opportunities)
- **[features/](./features/)** - Feature artifacts (PRD, tech spec, PRP, task plans)
- **[templates/](./templates/)** - Template files (PRP templates)
- **[reviews/](./reviews/)** - Code review reports
- **[testing/](./testing/)** - Test results
- **[execution/](./execution/)** - Task breakdown files
- **[.claude/commands/](./.claude/commands/)** - Workflow commands

## Core Commands

| Command | Description | Phase |
|---------|-------------|-------|
| `/prime` | Export codebase for context gathering | Prime |
| `/discovery` | Explore ideas and opportunities | Discovery |
| `/planning {feature}` | Generate PRD from discovery | Planning |
| `/development {feature}` | Generate tech spec from PRD | Development |
| `/task-planning {feature}` | Generate PRP and create tasks | Task Planning |
| `/execution {feature}` | Execute tasks sequentially | Execution |
| `/review {feature}` | Run code review | Review |
| `/test {feature}` | Run tests | Test |
| `/workflow {feature}` | Execute full workflow | All phases |

## Core Documents (Root Level)

- **[MVP.md](./MVP.md)** - Minimum Viable Product definition
- **[PRD.md](./PRD.md)** - Product Requirements Document
- **[TECH-SPEC.md](./TECH-SPEC.md)** - Technical Specification
- **[CLAUDE.md](./CLAUDE.md)** - Developer guidelines

## Quick Start

1. Run `/prime` to export codebase context
2. Run `/discovery` to explore opportunities
3. Run `/planning {feature-name}` to create PRD
4. Run `/development {feature-name}` to create tech spec
5. Run `/task-planning {feature-name}` to create implementation plan
6. Run `/execution {feature-name}` to implement tasks
7. Run `/review {feature-name}` to review code
8. Run `/test {feature-name}` to run tests

Or run `/workflow {feature-name}` to execute all phases automatically.

## Status

**Version**: 1.0
**Last Updated**: 2026-01-23
**Status**: In Development
```

### MVP.md

```markdown
# MVP: Smart Reference Library

**Version**: 1.1 | **Created**: 2026-01-24

## What We're Building

A token-efficient reference library with `/learn` command and brain health tracking - loading only what's relevant to the current task.

## Core Problem

All context gets loaded regardless of relevance. If building a Python feature, we don't need React patterns cluttering the LLM context.

## In Scope (Must Have)

### 1. Reference Directory Structure
```
references/
├── BRAIN.md          # Health dashboard
├── INDEX.md          # Available references
├── python/
├── mcp/
├── react/
├── ai-agents/
├── typescript/
├── testing/
└── patterns/
```

### 2. `/learn` Command
- `/learn {topic}` - Search RAG + web for topic
- Present findings for approval
- Save approved content to appropriate category
- Update BRAIN.md stats

### 3. `/learn-health` Command
- Check reference library health on demand
- Show stats per category
- Flag empty/stale categories
- Suggest what to learn next
- Quick overview without running full learn

### 4. Brain Health Tracking (`BRAIN.md`)
- Visual progress per category
- Empty categories flagged
- Last activity timestamp
- Growth tracking
- Suggestions for what to learn next

### 5. Skills Integration
- Skills can reference specific `references/` files
- References provide patterns, skills provide workflows
- Skills use selective loading same as PRP
- Example: `create-skill` skill references `references/patterns/skill-creation.md`

### 6. Selective Loading
- PRP and Skills specify only needed references
- CLAUDE.md doesn't preload everything
- Only relevant refs load into context
- Example: Python MCP task → load only `python/` + `mcp/`

## Out of Scope

- Business/non-technical content
- Automatic reference detection
- Reference versioning
- Cross-reference linking

## How It Integrates

- `/learn` builds the library (independent of PIV loop)
- PRP references specific files needed for task
- Only referenced files load into LLM context
- Brain health shows library growth

## Estimated Effort

2-3 days
```

### PRD.md

```markdown
# PRD: Smart Reference Library

**Version**: 1.0 | **Last Updated**: 2026-01-24

## Overview

A token-efficient reference library system with `/learn` and `/learn-health` commands. Organizes best practices by category, loads only what's relevant to current task.

### Goals

1. Build growing knowledge library via `/learn` command
2. Track library health via `/learn-health` command
3. Enable selective loading - only relevant refs load into context
4. Integrate with PRP and Skills for reference linking

### Success Metrics

- Library grows over time (tracked in BRAIN.md)
- Context stays lean (only relevant refs load)
- Empty categories get flagged and addressed

## User Stories

### US-1: Learn New Topics
**As** a Developer, **I want** to run `/learn {topic}` **so that** I can search RAG/web and save useful patterns to my reference library.

**Acceptance Criteria**:
- Search Archon RAG and web for topic
- Present findings for approval
- Save approved content to appropriate category folder
- Update BRAIN.md stats after save

### US-2: Check Library Health
**As** a Developer, **I want** to run `/learn-health` **so that** I can see which categories need attention.

**Acceptance Criteria**:
- Show stats per category (ref count, last updated)
- Flag empty or stale categories
- Suggest topics to learn next
- Display overall health percentage

### US-3: Selective Loading
**As** a Developer, **I want** PRP and Skills to reference only needed files **so that** LLM context stays lean.

**Acceptance Criteria**:
- PRP specifies which reference files to load
- Skills can reference specific reference files
- CLAUDE.md does not preload all references
- Only referenced files load into context

### US-4: Brain Dashboard
**As** a Developer, **I want** a BRAIN.md dashboard **so that** I can see library status at a glance.

**Acceptance Criteria**:
- Visual progress bars per category
- Last activity timestamp
- Growth tracking (refs added this week)
- Suggestions for what to learn

## Features

### Feature 1: Reference Storage (Archon Documents)
Store digested insights as Archon documents with category tags.

**Categories (via tags)**:
- python
- mcp
- react
- ai-agents
- typescript
- testing
- patterns

**Storage**: Archon/Supabase (not local markdown files)

**Priority**: High

### Feature 2: `/learn` Command
Command to search, digest, and save insights.

**Flow**:
1. User runs `/learn {topic}`
2. Search Archon RAG + web
3. **Digest into concise, actionable insights**
4. Present for approval
5. Store via `manage_document` with category tags

**Priority**: High

### Feature 3: `/learn-health` Command
Command to check library health on demand.

**Output**:
- Stats per category
- Empty/stale flags
- Suggestions
- Overall health score

**Priority**: High

### Feature 4: BRAIN Dashboard
Generated from Archon document stats.

**Contents**:
- Health percentage (calculated from category coverage)
- Per-category counts (queried from Archon)
- Last learned timestamp
- Growth metrics
- Suggestions for empty categories

**Note**: Stats queried live from Archon, not stored in markdown

**Priority**: Medium

### Feature 5: Skills Integration
Skills can reference specific reference files.

**How it works**:
- Skills specify needed references
- References provide patterns
- Skills provide workflows
- Selective loading applies

**Priority**: Medium

## Technical Requirements

### Architecture: Hybrid (Archon + Markdown)

**Storage**: Archon/Supabase documents
**Output**: Generated markdown (BRAIN.md) for quick reference

### New Files

| File | Purpose |
|------|---------|
| `.claude/commands/learn.md` | Learn command definition |
| `.claude/commands/learn-health.md` | Health check command |

### Integrations

- **Archon MCP**:
  - `rag_search_knowledge_base` - Search for topics
  - `manage_document` - Store digested insights
  - `find_documents` - Query references by category
- **Web Search**: External best practices
- **Archon Documents**: Store references (not local markdown files)

### Data Models

**Reference Document** (stored in Archon):
- `title`: Insight title
- `document_type`: "reference"
- `tags`: Category tags (python, mcp, react, etc.)
- `content`: Digested insight (concise, actionable)
- `source_url`: Original source (RAG/web)
- `created_at`: Timestamp

**BRAIN Stats** (queried from Archon):
- Count documents by tag/category
- Last updated per category
- Total reference count
- Health percentage calculated

### `/learn` Flow

1. User runs `/learn {topic}`
2. Search Archon RAG + web for topic
3. **Digest findings into concise insights**
4. Present for approval
5. Store approved insights via `manage_document`
6. Tags determine category

### Selective Loading Flow

1. PRP/Skill specifies needed categories (e.g., "python", "mcp")
2. Query: `find_documents(document_type="reference", query="python")`
3. Only relevant insights load into context

## Dependencies

### Required
- Archon MCP (RAG search)
- Existing command structure

### Optional
- Web MCP (enhanced web search)

## Out of Scope

- Business/non-technical content
- Automatic reference detection from code
- Reference versioning
- Cross-reference linking
```

### TECH-SPEC.md

```markdown
# Technical Specification: Smart Reference Library

**Version**: 1.0 | **Last Updated**: 2026-01-24

## System Architecture

### Overview

The Smart Reference Library uses Archon/Supabase as the storage backend. References are stored as Archon documents with category tags, enabling structured queries and selective loading.

```
┌─────────────────────────────────────────────────────────────┐
│                      User Commands                          │
│              /learn {topic}    /learn-health                │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  Command Layer                              │
│   .claude/commands/learn.md  .claude/commands/learn-health.md│
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  Research Layer                             │
│     rag_search_knowledge_base()    WebSearch (fallback)     │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  Digest Layer (LLM)                         │
│     Raw findings → Concise, actionable insights             │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  Storage Layer (Archon)                     │
│     manage_document()  find_documents()  find_projects()    │
└─────────────────────────────────────────────────────────────┘
```

### Design Principles

1. **Token Efficiency**: Only load relevant references via selective queries
2. **Digested Insights**: Store processed knowledge, not raw dumps
3. **Structured Storage**: Leverage Archon/Supabase for querying and stats
4. **Category Tagging**: Enable filtering by technology/domain

## Technology Stack

| Component | Technology | Purpose |
|-----------|------------|---------|
| Storage | Supabase (direct SQL) | `archon_references` table |
| Search | Archon RAG | Knowledge base search for topics |
| Web Research | WebSearch tool | External best practices |
| Commands | Markdown + YAML | Command definitions |
| Digest | LLM (Claude) | Process raw → insights |
| DB Access | Supabase JS/REST API | Direct table queries |

### MCP Servers

**Required**:
- `user-archon`: RAG search only (not for storage)

**Optional**:
- `web-search`: Enhanced web research (fallback to built-in)

### Database

**Table**: `archon_references` (dedicated, not project docs)
**Migration**: `012_add_smart_reference_library.sql`

## Data Models

### Dedicated Database Table

References are stored in a dedicated `archon_references` table (not in project docs JSONB).

**Migration**: `012_add_smart_reference_library.sql`

```sql
CREATE TABLE archon_references (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  category TEXT NOT NULL,  -- python, mcp, react, etc.
  tags TEXT[] DEFAULT '{}',
  content JSONB NOT NULL,  -- {summary, insights, code_examples, sources}
  source_url TEXT,
  author TEXT DEFAULT 'AI Coding System',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_archon_references_category ON archon_references(category);
CREATE INDEX idx_archon_references_tags ON archon_references USING GIN(tags);
```

### Reference Record

Each reference stored as a row:

```json
{
  "id": "uuid",
  "title": "Python Async Best Practices",
  "category": "python",
  "tags": ["async", "concurrency", "patterns"],
  "content": {
    "summary": "Key patterns for async Python development",
    "insights": [
      "Use asyncio.gather() for concurrent tasks",
      "Avoid mixing sync/async - use async all the way down",
      "Use asyncio.create_task() for fire-and-forget"
    ],
    "code_examples": [
      {
        "title": "Concurrent HTTP requests",
        "language": "python",
        "code": "async def fetch_all(urls): ..."
      }
    ],
    "sources": ["https://docs.python.org/3/library/asyncio.html"],
    "learned_at": "2026-01-24T19:00:00Z"
  },
  "source_url": "https://docs.python.org/3/library/asyncio.html",
  "author": "AI Coding System"
}
```

### Direct SQL Queries

Since we're using a dedicated table (not Archon MCP documents), queries are direct SQL:

```sql
-- Insert reference
INSERT INTO archon_references (title, category, tags, content, source_url)
VALUES ('Python Async', 'python', ARRAY['async'], '{"summary": "..."}', 'https://...');

-- Query by category
SELECT * FROM archon_references WHERE category = 'python';

-- Query by tag
SELECT * FROM archon_references WHERE 'async' = ANY(tags);

-- Get stats per category
SELECT category, COUNT(*) as count, MAX(updated_at) as last_updated
FROM archon_references GROUP BY category;
```

### Category Tags

Standard category tags for filtering:

| Tag | Description |
|-----|-------------|
| `python` | Python patterns, libraries, best practices |
| `typescript` | TypeScript/JavaScript patterns |
| `react` | React components, hooks, patterns |
| `mcp` | MCP server development |
| `ai-agents` | AI agent patterns, prompting |
| `testing` | Testing patterns, frameworks |
| `patterns` | General design patterns |
| `supabase` | Supabase/database patterns |
| `api` | API design, REST, GraphQL |

### BRAIN Stats Model

Stats calculated from Archon queries:

```json
{
  "total_references": 15,
  "categories": {
    "python": { "count": 5, "last_updated": "2026-01-24" },
    "mcp": { "count": 3, "last_updated": "2026-01-23" },
    "react": { "count": 0, "last_updated": null },
    "testing": { "count": 2, "last_updated": "2026-01-22" }
  },
  "health_percentage": 60,
  "empty_categories": ["react", "ai-agents"],
  "suggestions": ["Learn React hooks", "Learn AI agent patterns"]
}
```

## Command Structure

### `/learn` Command

**File**: `.claude/commands/learn.md`

```yaml
---
name: Learn
description: "Search, digest, and save knowledge to reference library"
phase: independent
dependencies: []
inputs:
  - name: topic
    description: "Topic to learn (e.g., 'python async', 'react hooks')"
    required: true
outputs:
  - path: "Archon document"
    description: "Digested insight stored in Archon"
---
```

**Execution Flow**:

1. **Parse Topic**: Extract keywords and infer category
2. **Search RAG**: `rag_search_knowledge_base(query="{topic}", match_count=5)`
3. **Search Web** (optional): WebSearch for external resources
4. **Digest Findings**: LLM processes raw results into:
   - Summary (1-2 sentences)
   - Key insights (3-5 bullet points)
   - Code examples (if applicable)
   - Sources
5. **Present for Approval**: Show digest to user
6. **Store on Approval** (direct SQL via Supabase):
   ```sql
   INSERT INTO archon_references (title, category, tags, content, source_url)
   VALUES (
     'Python Async Best Practices',
     'python',
     ARRAY['async', 'concurrency'],
     '{"summary": "...", "insights": [...], "code_examples": [...], "sources": [...]}',
     'https://docs.python.org/...'
   );
   ```
7. **Confirm**: Show success message

### `/learn-health` Command

**File**: `.claude/commands/learn-health.md`

```yaml
---
name: Learn Health
description: "Check reference library health and stats"
phase: independent
dependencies: []
outputs:
  - description: "Health report displayed to user"
---
```

**Execution Flow**:

1. **Query Stats** (direct SQL via Supabase):
   ```sql
   SELECT category, COUNT(*) as count, MAX(updated_at) as last_updated
   FROM archon_references
   GROUP BY category;
   ```
2. **Calculate Health**:
   - Count refs per category
   - Find empty categories (compare against standard list)
   - Calculate health percentage
3. **Generate Suggestions**: Based on empty/stale categories
4. **Display Report**:
   ```
   ## Brain Health: 60%

   | Category | Refs | Last Updated |
   |----------|------|--------------|
   | python   | 5    | 2026-01-24   |
   | mcp      | 3    | 2026-01-23   |
   | react    | 0    | -            |

   **Empty**: react, ai-agents
   **Suggestions**: Learn React hooks, Learn AI agent patterns
   ```

## Integration Points

### PRP Integration

PRPs specify needed references via tags:

```markdown
## All Needed Context

### Reference Library
Load references with tags: ["python", "mcp"]
```

**Loading Flow**:
1. PRP parser extracts required categories/tags
2. Query (direct SQL):
   ```sql
   SELECT * FROM archon_references
   WHERE category = 'python' OR 'mcp' = ANY(tags);
   ```
3. Load matching references into context
4. Agent has relevant insights available

### Skills Integration

Skills can specify reference dependencies:

```markdown
## Prerequisites

### Reference Library
Required: ["mcp", "patterns"]
```

**Loading Flow**: Same as PRP - selective query by tags.

### CLAUDE.md Integration

CLAUDE.md does NOT preload references. Instead:

```markdown
## Reference Library

References are stored in Archon under project "Smart Reference Library".
Use `/learn {topic}` to add new references.
Use `/learn-health` to check library status.

PRP and Skills specify which references to load via tags.
```

## Implementation Plan

### Phase 1: Setup (Required First)

1. **Run SQL Migration**
   - Execute `012_add_smart_reference_library.sql` in Supabase SQL Editor
   - Creates `archon_references` table with indexes and RLS

2. **Create Command Files**
   - `.claude/commands/learn.md`
   - `.claude/commands/learn-health.md`

### Phase 2: `/learn` Command

1. **Parse topic and infer category**
   - Keywords → category mapping
   - Example: "python async" → tags: ["python", "async"]

2. **Search and gather sources**
   - RAG search first
   - Web search if needed

3. **Digest into insights**
   - Prompt LLM to summarize
   - Extract actionable patterns
   - Include code examples

4. **Approval flow**
   - Present digest
   - Wait for user confirmation
   - Store on approval

### Phase 3: `/learn-health` Command

1. **Query all documents**
   - `find_documents(project_id="{id}")`

2. **Aggregate by tags**
   - Count per category
   - Track last updated

3. **Calculate health**
   - Categories covered / total categories
   - Flag empty categories

4. **Generate report**
   - Table format
   - Suggestions for empty categories

### Phase 4: Integration

1. **Update PRP templates**
   - Add reference loading section

2. **Document in CLAUDE.md**
   - Reference library usage

## Error Handling

| Error | Handling |
|-------|----------|
| Supabase unavailable | Inform user, suggest retry later |
| Table not found | Prompt to run migration SQL |
| No results from RAG | Fall back to web search |
| No results from web | Inform user, suggest different topic |
| Insert fails | Show error, offer retry |
| Health query fails | Show partial results if available |

## Performance Considerations

1. **Query Optimization**
   - Use `per_page` limit for document queries
   - Query by specific tags rather than all documents

2. **Token Efficiency**
   - Digests are concise (not full articles)
   - Selective loading only what's needed
   - Category-based filtering

3. **Caching**
   - Project ID can be cached (rarely changes)
   - Stats can be calculated on-demand (no caching needed)

## Security

1. **Content Filtering**
   - Only technical/coding content
   - No business secrets or sensitive data
   - User approval before storage

2. **Source Attribution**
   - Track source URLs
   - Maintain provenance

## Validation Checklist

### `/learn` Command
- [ ] Topic parsed correctly
- [ ] RAG search executed
- [ ] Findings digested into insights
- [ ] Approval flow works
- [ ] Document stored in Archon
- [ ] Correct tags applied

### `/learn-health` Command
- [ ] Documents queried successfully
- [ ] Stats calculated correctly
- [ ] Empty categories identified
- [ ] Health percentage accurate
- [ ] Suggestions generated

### Integration
- [ ] PRP can specify reference tags
- [ ] Selective loading works
- [ ] CLAUDE.md updated
```

### README.md

```markdown
# AI Coding Workflow System

A markdown-based command system for orchestrating AI-assisted development workflows through MCP integration.

## Overview

This system manages the complete development lifecycle from codebase context gathering through implementation, review, and testing. It uses markdown files for all artifacts and integrates with MCP (Model Context Protocol) servers for task management, knowledge base queries, and web research.

## Features

- **Prime Export**: Comprehensive codebase context gathering
- **Discovery**: AI-powered exploration of ideas and opportunities
- **Planning**: Automated PRD generation from discovery
- **Development**: Tech spec generation with stack recommendations
- **Task Planning**: PRP (Plan Reference Protocol) generation with task breakdown
- **Execution**: Sequential task execution with progress tracking
- **Review**: AI-powered code review with compliance verification
- **Testing**: Automated testing with AI-suggested fixes
- **Unified Workflow**: Single command for complete lifecycle

## Quick Start

### Prerequisites

- Claude Code CLI
- Archon MCP server (recommended)
- Web MCP servers (recommended)

### Basic Usage

```bash
# Export codebase context
/prime

# Explore opportunities
/discovery

# Create feature requirements
/planning my-feature

# Generate technical specification
/development my-feature

# Create implementation plan
/task-planning my-feature

# Execute implementation
/execution my-feature

# Review code
/review my-feature

# Run tests
/test my-feature
```

### Unified Workflow

Execute all phases with a single command:

```bash
/workflow my-feature
```

### Resume from Phase

Resume from any phase if errors occur:

```bash
/workflow my-feature --from-development
```

## Directory Structure

```
project-root/
├── .claude/
│   ├── commands/          # Workflow commands
│   └── templates/         # STATUS.md template
├── context/               # Prime exports
├── discovery/             # Discovery documents
├── features/              # Feature artifacts
│   └── {feature-name}/
│       ├── prd.md
│       ├── tech-spec.md
│       ├── prp.md
│       ├── task-plan.md
│       └── STATUS.md
├── templates/
│   └── prp/               # PRP templates
├── reviews/               # Review reports
├── testing/               # Test results
├── execution/             # Task breakdown files
├── PRD.md                 # Product Requirements Document
├── TECH-SPEC.md           # Technical Specification
├── CLAUDE.md              # Developer guidelines
└── README.md              # This file
```

## Documentation

- **[PRD.md](./PRD.md)** - Complete product requirements
- **[TECH-SPEC.md](./TECH-SPEC.md)** - Technical specifications
- **[CLAUDE.md](./CLAUDE.md)** - Development guidelines
- **[INDEX.md](./INDEX.md)** - System navigation

## License

MIT License - See LICENSE file for details
```

### context/INDEX.md

```markdown
# Context Index

## Overview
This directory contains codebase context exports from the Prime command. Each export is a complete snapshot of the codebase at a specific point in time, including file tree structure and file contents.

## Files

### prime-2026-01-24T18-21-11Z.md
- **Created**: 2026-01-24T18:21:11Z
- **Description**: Complete codebase export from Prime command
- **File Count**: 27 files
- **Total Lines**: ~3,500 lines
- **Link**: [View Export](./prime-2026-01-24T18-21-11Z.md)

### prime-2026-01-24T09-32-50Z.md
- **Created**: 2026-01-24T09:32:50Z
- **Description**: Complete codebase export from Prime command
- **File Count**: 47 files
- **Total Lines**: ~4,200 lines
- **Link**: [View Export](./prime-2026-01-24T09-32-50Z.md)

## Navigation
- [Back to Root](../)
- [Discovery](../discovery/)
- [Features](../features/)
```

### discovery/INDEX.md

```markdown
# Discovery Index

## Overview
This directory contains discovery phase outputs. Discovery documents explore ideas, inspiration, and needs for AI agents and AI/ATR applications, identifying opportunities and prioritizing features.

## Files

### discovery-2026-01-24T18-33-22Z.md
- **Created**: 2026-01-24T18:33:22Z
- **Description**: Discovery for AI Coding Workflow System enhancements
- **Ideas**: 8 AI agent opportunities identified
- **Top Priority**: Workflow Automation Agent, Code Generation, Automated Review
- **Recommended MVP**: Enhanced Workflow System with Code Generation
- **Link**: [View Discovery](./discovery-2026-01-24T18-33-22Z.md)

## Navigation
- [Back to Root](../)
- [Context](../context/)
- [Features](../features/)
```

### execution/INDEX.md

```markdown
# Execution Directory

This directory contains task execution documents linked to Archon MCP tasks. Each file represents a numbered task in the AI Coding Workflow System implementation.

## Purpose
- Track implementation tasks with detailed steps
- Link Archon tasks to documentation
- Provide implementation guidance
- Track completion status

## Tasks

| # | Task | Status | Description |
|---|------|--------|-------------|
| 01 | [Create Directory Structure](01-create-directory-structure.md) | Done | Create project directory structure |
| 02 | [Create INDEX.md Generator](02-create-index-generator.md) | Done | Implement INDEX.md generation utility |
| 03 | [Create STATUS.md Format](03-create-status-format.md) | Done | Implement STATUS.md tracking format |
| 04 | [Create Command Template](04-create-command-template.md) | Done | Create reusable command template |
| 05 | [Implement Prime Command](05-implement-prime-command.md) | Done | Export codebase context |
| 06 | [Implement Discovery Command](06-implement-discovery-command.md) | Done | Explore ideas with RAG/web research |
| 07 | [Implement Planning Command](07-implement-planning-command.md) | Done | Generate PRD from discovery |
| 08 | [Implement Development Command](08-implement-development-command.md) | Done | Generate TECH-SPEC from PRD |
| 09 | [Create PRP Base Template](09-create-prp-base-template.md) | Done | Base template for task plans |
| 10 | [Create PRP Specialized Templates](10-create-prp-specialized-templates.md) | Done | Specialized PRP templates |
| 11 | [Implement Pattern Extraction](11-implement-pattern-extraction.md) | Done | Extract codebase patterns |
| 12 | [Implement Task Planning Command](12-implement-task-planning-command.md) | Done | Generate PRP and create tasks |
| 13 | [Implement Execution Command](13-implement-execution-command.md) | Done | Execute tasks from PRP |
| 14 | [Implement Review Command](14-implement-review-command.md) | Done | Code review and analysis |
| 15 | [Implement Test Command](15-implement-test-command.md) | Done | Run tests and generate reports |
| 16 | [Implement Workflow Command](16-implement-workflow-command.md) | Done | Unified workflow with resume |
| 17 | [Implement Error Handling](17-implement-error-handling.md) | Done | Comprehensive error handling |
| 18 | [Integrate Archon MCP](18-integrate-archon-mcp.md) | Done | Archon MCP integration |
| 19 | [Integrate Web MCP Servers](19-integrate-web-mcp-servers.md) | Done | Web MCP integration |
| 20 | [End-to-End Testing](20-end-to-end-testing.md) | Done | Full system testing |
| 21 | [Create Main INDEX.md](21-create-main-index.md) | Done | Root navigation index |
| 22 | [Create README.md](22-create-readme.md) | Done | Project documentation |
| 23 | [Performance Optimization](23-performance-optimization.md) | Done | System optimization |
| 24 | [System Validation](24-system-validation-final-testing.md) | Done | Final validation testing |
| 25 | [Documentation Review](25-documentation-review-updates.md) | Done | Documentation audit |
| 26 | [Security Audit](26-security-audit-hardening.md) | Done | Security hardening |
| 27 | [UAT Preparation](27-user-acceptance-testing-preparation.md) | Done | User testing prep |
| 28 | [Deployment Handoff](28-system-deployment-handoff.md) | Done | Final deployment |

## Links
- [../INDEX.md](../INDEX.md) - Root index
- [../.claude/commands/](../.claude/commands/) - Command files
- [../features/](../features/) - Feature implementations
```

### features/INDEX.md

```markdown
# Features Index

## Overview
This directory contains all feature-specific artifacts organized by feature name. Each feature has its own subdirectory with PRD, tech spec, PRP, task plans, execution logs, reviews, and test results.

## Features

### smart-reference-library
- **Status**: Task Planning Completed
- **Description**: Token-efficient reference library with /learn and /learn-health commands
- **Phase**: Ready for Execution
- **Artifacts**:
  - [PRP](./smart-reference-library/prp.md)
  - [Task Plan](./smart-reference-library/task-plan.md)
  - [STATUS](./smart-reference-library/STATUS.md)
- **Archon Project ID**: `acf45b67-51aa-475d-b4cc-7c1055b4a032`

## Navigation
- [Back to Root](../)
- [Context](../context/)
- [Discovery](../discovery/)
```

### features/smart-reference-library/STATUS.md

```markdown
# STATUS: Smart Reference Library

**Feature**: Smart Reference Library
**Created**: 2026-01-24
**Current Phase**: Task Planning - Completed

## Phase Progress

| Phase | Status | Completed |
|-------|--------|-----------|
| Discovery | Completed | 2026-01-24 |
| MVP | Completed | 2026-01-24 |
| Planning (PRD) | Completed | 2026-01-24 |
| Development (TECH-SPEC) | Completed | 2026-01-24 |
| Task Planning | Completed | 2026-01-24 |
| Execution | Not Started | - |
| Review | Not Started | - |
| Test | Not Started | - |

## Current Phase: Execution

**Next Task**: Run SQL migration for archon_references table

## Artifacts

| Artifact | Path | Status |
|----------|------|--------|
| MVP | `MVP.md` | Complete |
| PRD | `PRD.md` | Complete |
| TECH-SPEC | `TECH-SPEC.md` | Complete |
| SQL Migration | `Archon MCP/migration/012_add_smart_reference_library.sql` | Complete |
| PRP | `features/smart-reference-library/prp.md` | Complete |
| Task Plan | `features/smart-reference-library/task-plan.md` | Complete |
| /learn command | `.claude/commands/learn.md` | Pending |
| /learn-health command | `.claude/commands/learn-health.md` | Pending |

## Archon Project

**Project ID**: `acf45b67-51aa-475d-b4cc-7c1055b4a032`
**Tasks Created**: 7

## Notes

- Uses dedicated `archon_references` table (not project docs JSONB)
- Direct SQL via Supabase (not Archon MCP document tools)
- RAG search for topic research, LLM for digest
- User approval required before storage
```

### features/smart-reference-library/prp.md

```markdown
# PRP: Smart Reference Library

**Version**: 1.0 | **Last Updated**: 2026-01-24 | **Related**: MVP.md, PRD.md, TECH-SPEC.md

## Goal

### Feature Goal
Build a token-efficient reference library with `/learn` and `/learn-health` commands that stores digested coding insights in a dedicated Supabase table, enabling selective context loading based on current task needs.

### Deliverable
- SQL migration: `012_add_smart_reference_library.sql` (created)
- Command: `.claude/commands/learn.md`
- Command: `.claude/commands/learn-health.md`
- Updated: `templates/prp/prp-base.md` with Reference Library section
- Updated: `CLAUDE.md` with Reference Library documentation

### Success Criteria
- `/learn {topic}` searches RAG/web, digests findings, stores approved insights
- `/learn-health` displays category stats, health percentage, suggestions
- PRP templates can specify required reference categories
- References stored in dedicated `archon_references` table (not project docs)

## All Needed Context

### Documentation URLs
- Supabase SQL reference: https://supabase.com/docs/guides/database
- Archon RAG API: See `mcps/user-archon/tools/*.json`

### Codebase Patterns
- Commands use YAML frontmatter + markdown body
- Commands define inputs, outputs, execution steps
- Existing commands: `.claude/commands/*.md`

### File References
- Command template: `.claude/commands/template.md`
- Existing commands: `prime.md`, `discovery.md`, `planning.md`, `development.md`
- PRP base template: `templates/prp/prp-base.md`

### Naming Conventions
- Commands: lowercase with hyphens (e.g., `learn-health.md`)
- Supabase tables: `archon_` prefix (e.g., `archon_references`)
- Indexes: `idx_archon_references_{column}`

### Architecture Patterns
- Direct SQL via Supabase (not Archon MCP documents)
- RAG search for topic research
- LLM digest for insight extraction
- User approval before storage

## Implementation Blueprint

### Data Models

**archon_references table** (already defined in migration):
```sql
- id: UUID PRIMARY KEY
- title: TEXT NOT NULL
- category: TEXT NOT NULL (python, mcp, react, etc.)
- tags: TEXT[] (additional tags)
- content: JSONB (summary, insights, code_examples, sources)
- source_url: TEXT
- author: TEXT
- created_at, updated_at: TIMESTAMPTZ
```

**Content JSONB structure**:
```json
{
  "summary": "string",
  "insights": ["string"],
  "code_examples": [{"title": "", "language": "", "code": ""}],
  "sources": ["url"],
  "learned_at": "timestamp"
}
```

### Implementation Tasks

| Order | Task | Dependencies | Estimate |
|-------|------|--------------|----------|
| 1 | Run SQL migration | None | 5 min |
| 2 | Create /learn command | Migration done | 1 hour |
| 3 | Create /learn-health command | Migration done | 45 min |
| 4 | Update PRP templates | Commands done | 30 min |
| 5 | Update CLAUDE.md | Commands done | 30 min |
| 6 | Test /learn command | All above | 30 min |
| 7 | Test /learn-health command | All above | 30 min |

### File Structure

```
.claude/commands/
├── learn.md              # New
├── learn-health.md       # New
└── ... (existing)

templates/prp/
├── prp-base.md           # Update (add Reference Library section)
└── ... (existing)

features/smart-reference-library/
├── prp.md                # This file
├── task-plan.md          # Task tracking
└── STATUS.md             # Progress tracking

Archon MCP/migration/
└── 012_add_smart_reference_library.sql  # Created
```

### Integration Points

**Supabase Direct SQL**:
- INSERT for storing references
- SELECT for querying by category/tags
- GROUP BY for stats calculation

**Archon RAG**:
- `rag_search_knowledge_base(query, match_count)` for topic research
- `rag_read_full_page(page_id)` for full content

**Web Search** (fallback):
- WebSearch tool if RAG returns no results

## Validation Loop

### Syntax Validation
- YAML frontmatter valid in command files
- SQL migration runs without errors
- Markdown formatting correct

### Unit Tests
- SQL: Insert/query references manually in Supabase
- Commands: Verify YAML parsing works

### Integration Tests
- `/learn python async`: Full flow from search to storage
- `/learn-health`: Stats calculation with test data

### End-to-End Tests
1. Run migration in Supabase
2. Execute `/learn mcp server patterns`
3. Approve digest
4. Verify row in `archon_references`
5. Run `/learn-health`
6. Verify stats show new reference

## Anti-Patterns

### General Anti-Patterns
- Skipping user approval before storage
- Storing raw content instead of digested insights
- Preloading all references in CLAUDE.md
- Using Archon project docs instead of dedicated table

### Feature-Specific Anti-Patterns
- Long RAG queries (keep to 2-5 keywords)
- Storing non-technical content
- Missing category/tags on references
- Not handling Supabase connection errors
```

### features/smart-reference-library/task-plan.md

```markdown
# Task Plan: Smart Reference Library

**Generated**: 2026-01-24T11:24:00Z
**PRP Version**: 1.0
**Total Tasks**: 7
**Archon Project ID**: `acf45b67-51aa-475d-b4cc-7c1055b4a032`

## Task List

| Task ID | Task Title | Dependencies | Priority | Estimate | Status |
|---------|------------|--------------|----------|----------|--------|
| `da02cd4b-208c-48ca-9089-88edb1ee47ef` | Run SQL migration for archon_references table | None | 100 | 5 min | todo |
| `4e570391-cbeb-4439-90c3-ead0254137f2` | Create /learn command file | Task 1 | 90 | 1 hour | todo |
| `ed1fea70-2c91-4a98-9d2b-2655f49f58b8` | Create /learn-health command file | Task 1 | 80 | 45 min | todo |
| `a259b76e-7201-4f80-9f61-894dbfdaaedc` | Update PRP templates with Reference Library section | Tasks 2,3 | 70 | 30 min | todo |
| `28e0409f-b91b-4bee-be20-23176ab8ea8b` | Update CLAUDE.md with Reference Library documentation | Tasks 2,3 | 60 | 30 min | todo |
| `3fa7bbe6-2ebd-4e7a-bf70-cdca8cea43b5` | Test /learn command end-to-end | Tasks 1-5 | 50 | 30 min | todo |
| `40648c16-1af0-4d2e-9e59-83df45e0421a` | Test /learn-health command | Tasks 1-5 | 40 | 30 min | todo |

## Execution Order

1. **Task da02cd4b**: Run SQL migration for archon_references table
2. **Task 4e570391**: Create /learn command file
3. **Task ed1fea70**: Create /learn-health command file
4. **Task a259b76e**: Update PRP templates with Reference Library section
5. **Task 28e0409f**: Update CLAUDE.md with Reference Library documentation
6. **Task 3fa7bbe6**: Test /learn command end-to-end
7. **Task 40648c16**: Test /learn-health command

## Next Steps

1. Run migration `012_add_smart_reference_library.sql` in Supabase SQL Editor
2. Mark Task 1 as `doing` then `done` in Archon
3. Proceed to Task 2: Create /learn command
4. Track progress in Archon MCP

## Commands

```bash
# Mark task as doing
manage_task("update", task_id="da02cd4b-208c-48ca-9089-88edb1ee47ef", status="doing")

# Mark task as done
manage_task("update", task_id="da02cd4b-208c-48ca-9089-88edb1ee47ef", status="done")

# Get next todo task
find_tasks(filter_by="status", filter_value="todo")
```
```

### templates/INDEX.md

```markdown
# Templates Index

## Overview
This directory contains template files for the AI Coding Workflow System, including PRP (Plan Reference Protocol) templates.

## Templates

### PRP Templates
- [PRP Base Template](./prp/prp-base.md)
- [PRP AI Agent Template](./prp/prp-ai-agent.md)
- [PRP MCP Integration Template](./prp/prp-mcp-integration.md)
- [PRP API Endpoint Template](./prp/prp-api-endpoint.md)
- [PRP Frontend Component Template](./prp/prp-frontend-component.md)

## Navigation
- [Back to Root](../)
- [Features](../features/)
```

### reviews/INDEX.md

```markdown
# Reviews Index

## Overview

This directory contains code review reports generated by the Review command. Reviews analyze code quality, security, performance, and compliance with PRD and tech spec.

## Files

_No review reports yet._

## Navigation

- [Back to Root](../)
- [Features](../features/)
- [Testing](../testing/)
```

### testing/INDEX.md

```markdown
# Testing Index

## Overview

This directory contains test execution results generated by the Test command. Test results include test outcomes, coverage analysis, and AI-suggested fixes.

## Files

_No test results yet._

## Navigation

- [Back to Root](../)
- [Features](../features/)
- [Reviews](../reviews/)
```

## Index

### Statistics
- **Total Files**: 97 files
- **Total Lines**: ~15,000 lines (estimated)
- **Languages**:
  - Markdown: 97 files
  - JSON: 1 file
- **Dependencies**:
  - Claude Code CLI
  - Archon MCP server
  - Web MCP servers (optional)
  - Supabase (for Smart Reference Library feature)

### File Type Breakdown
- Command files: 12 (.claude/commands/)
- Template files: 6 (templates/)
- Core documentation: 5 (root level)
- Index files: 7 (various directories)
- Feature artifacts: 3 (features/smart-reference-library/)
- Task execution files: 28 (execution/)
- Context exports: 2 (context/)
- Discovery documents: 1 (discovery/)

### Key Components

1. **Command System**: 12 markdown-based workflow commands
2. **Template System**: PRP templates for various feature types
3. **Feature Tracking**: STATUS.md and task-plan.md for progress
4. **Documentation**: PRD, TECH-SPEC, MVP, README, CLAUDE.md
5. **Integration**: Archon MCP for task management and knowledge base
6. **Smart Reference Library**: Token-efficient reference system (in development)

### Project Status
- **Version**: 1.0
- **Last Updated**: 2026-01-24
- **Current Status**: In Development
- **Active Feature**: Smart Reference Library (Task Planning completed, ready for Execution)
